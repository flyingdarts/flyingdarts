name: Main Angular Workflow (Development)

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "The environment to deploy to"
        required: true
        default: "development"

  workflow_call:
  push:
    paths:
      - "apps/frontend/angular/**"
      - ".github/workflows/main_angular_dev.yml"

  pull_request:
    paths:
      - "apps/frontend/angular/**"
      - ".github/workflows/main_angular_dev.yml"


jobs:
  build-angular-dev:
    uses: ./.github/workflows/build-angular-app.yml
    with:
      project-name: "fd-app"
      project-directory: "apps/frontend/angular/fd-app"
      configuration: "development"
      environment: "development"
      node-version: "22"

  deploy-angular-dev:
    needs: build-angular-dev
    uses: ./.github/workflows/deploy-angular-app.yml
    with:
      project-name: "fd-app"
      environment: "development"
    secrets:
      AWS_REGION: ${{ secrets.AWS_REGION }}
      AWS_DEPLOYMENT_ROLE_ARN: ${{ secrets.AWS_DEPLOYMENT_ROLE_ARN }}
      AWS_CLOUDFRONT_DISTRIBUTION_ID: ${{ secrets.AWS_CLOUDFRONT_DISTRIBUTION_ID_DEV }}
